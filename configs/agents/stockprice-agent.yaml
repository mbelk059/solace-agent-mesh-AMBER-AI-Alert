log:
  stdout_log_level: INFO

!include ../shared_config.yaml

# =============================================================================
# This agent queries historical stock analyst ratings using Marketstack API.
# Provides buy/sell/hold ratings and tracks analyst performance over time.
#
# Example usage:
#   "Get analyst ratings for AAPL from the last 6 months"
#   "Show me buy ratings for TSLA,MSFT from 2024"
#   "What are the current analyst recommendations for NVDA?"
# =============================================================================

apps:
  - name: stock-ratings-agent_app
    app_base_path: .
    app_module: solace_agent_mesh.agent.sac.app

    broker:
      <<: *broker_connection

    app_config:
      namespace: ${NAMESPACE, sam/}
      supports_streaming: true
      agent_name: "StockEODAgent"
      display_name: "Stock EOD Data Agent"
      model: *general_model

      instruction: |
        You are a stock market analyst assistant that provides historical end-of-day (EOD) price data.
        You use the Marketstack API to fetch daily stock prices, volumes, and adjusted prices.

        CAPABILITIES:
        - Get EOD data for any stock ticker (get_eod_data)
        - Filter by date range (historical data available)
        - Track multiple tickers simultaneously
        - Analyze price trends and statistics (analyze_price_trends)
        - Generate price reports and charts (artifact tools)

        IMPORTANT - TICKER FORMAT:
        Always specify tickers in uppercase, for example:
        - "AAPL" (Apple)
        - "MSFT" (Microsoft)
        - "AAPL,MSFT,GOOGL" (multiple tickers, comma-separated)
        - Replace periods with hyphens: "BRK.B" â†’ "BRK-B"

        WORKFLOW for analyzing stocks:
        1. Use get_eod_data to fetch historical price data
        2. Use analyze_price_trends to calculate statistics
        3. Identify price patterns, trends, and volatility
        4. Compare performance across multiple stocks
        5. Generate formatted reports with insights
        6. Use create_artifact to save as "STOCK_REPORT.md"

        FORMAT your reports using these sections:
        - **Price Summary**: Current price, highs, lows, changes
        - **Trend Analysis**: Price movements and patterns
        - **Volume Analysis**: Trading volume statistics
        - **Performance**: Returns over different periods
        - **Key Insights**: Notable observations and recommendations

        DATA FIELDS AVAILABLE:
        - open, high, low, close: Daily price data
        - volume: Trading volume
        - adj_open, adj_high, adj_low, adj_close: Adjusted for splits/dividends
        - split_factor, dividend: Corporate action data

        DATE FORMATS:
        Always use YYYY-MM-DD format for dates (e.g., "2024-01-01").

        PAGINATION:
        - Default limit: 100 results per request
        - Maximum limit: 1000 results
        - Use offset for additional pages

      tools:
        # Marketstack EOD API tool
        - tool_type: python
          component_module: "src.stock_tools"
          component_base_path: .
          function_name: "get_eod_data"
          tool_config:
            marketstack_api_key: ${MARKETSTACK_API_KEY,}

        # Price trend analysis tool
        - tool_type: python
          component_module: "src.stock_tools"
          component_base_path: .
          function_name: "analyze_price_trends"

        # Built-in artifact tools for saving reports
        - tool_type: builtin-group
          group_name: artifact_management

      session_service:
        type: ${PERSISTENCE_TYPE, memory}
        database_url: ${CUSTOM_AGENT_DATABASE_URL,}

      artifact_service: *default_artifact_service

      agent_card:
        description: >
          Stock EOD Data Agent - Analyzes historical end-of-day stock prices from Marketstack API
          for any stock ticker. Use this agent when the user asks about stock prices, historical
          price data, trading volumes, price trends, or wants to analyze stock performance over time.
          Examples: "Get AAPL price data for the last 30 days", "Show me TSLA,MSFT price history 
          from 2024", "What was NVDA's closing price yesterday?", "Compare price trends for tech stocks".
        defaultInputModes: ["text"]
        defaultOutputModes: ["text", "file"]
        skills:
          - id: "eod_data"
            name: "EOD Stock Data"
            description: "Get end-of-day price data for stock tickers"
          - id: "price_trends"
            name: "Price Trend Analysis"
            description: "Analyze price movements and trends over time"
          - id: "multi_ticker"
            name: "Multi-Ticker Analysis"
            description: "Compare price data across multiple stocks"

      agent_card_publishing:
        interval_seconds: 10

      agent_discovery:
        enabled: true

      inter_agent_communication:
        allow_list: ["OrchestratorAgent"]
        request_timeout_seconds: 60